import { createClient } from '@supabase/supabase-js';

const SUPABASE_URL = "https://xuschdhbuudskbtdzumr.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh1c2NoZGhidXVkc2tidGR6dW1yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyNDg4NjAsImV4cCI6MjA2OTgyNDg2MH0.rB4vthe8nRMiAOv-cBottUn6HO8Fu3ng5-khOkXcAXU";

// Pou≈æijeme public key a budeme vytv√°≈ôet data pro konkr√©tn√≠ho u≈æivatele
const supabase = createClient(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY);

// Uk√°zkov√© zdroje zpr√°v
const sampleSources = [
  {
    name: "ƒåT24",
    url: "https://ct24.ceskatelevize.cz",
    category: "V≈°echny",
    is_active: true,
    created_by_user_id: "temp-user-id" // Bude nahrazeno skuteƒçn√Ωm user ID
  },
  {
    name: "iDNES.cz",
    url: "https://idnes.cz",
    category: "V≈°echny", 
    is_active: true,
    created_by_user_id: "temp-user-id"
  },
  {
    name: "Aktu√°lnƒõ.cz",
    url: "https://aktualne.cz",
    category: "V≈°echny",
    is_active: true,
    created_by_user_id: "temp-user-id"
  },
  {
    name: "Respekt",
    url: "https://respekt.cz",
    category: "V≈°echny",
    is_active: true,
    created_by_user_id: "temp-user-id"
  },
  {
    name: "Root.cz",
    url: "https://root.cz",
    category: "Technologie",
    is_active: true,
    created_by_user_id: "temp-user-id"
  },
  {
    name: "Lupa.cz",
    url: "https://lupa.cz",
    category: "Technologie",
    is_active: true,
    created_by_user_id: "temp-user-id"
  },
  {
    name: "iSport.cz",
    url: "https://isport.blesk.cz",
    category: "Sport",
    is_active: true,
    created_by_user_id: "temp-user-id"
  },
  {
    name: "Hospod√°≈ôsk√© noviny",
    url: "https://hn.cz",
    category: "Finance",
    is_active: true,
    created_by_user_id: "temp-user-id"
  }
];

// Uk√°zkov√© ƒçl√°nky
const sampleArticles = [
  {
    title: "Umƒõl√° inteligence revoluci v ƒçesk√© zdravotnictv√≠",
    summary: "ƒåesk√© nemocnice zaƒç√≠naj√≠ implementovat AI syst√©my pro diagnostiku. Nov√© technologie mohou v√Ωznamnƒõ zrychlit a zp≈ôesnit diagnostick√© procesy, zejm√©na v oblasti onkologie a radiologie. Pilotn√≠ projekt prob√≠h√° ve Fakultn√≠ nemocnici Motol a ukazuje slibn√© v√Ωsledky.",
    category: "Technologie",
    published_at: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(), // 2 hodiny zpƒõt
    original_url: "https://ct24.ceskatelevize.cz/domaci/ai-ve-zdravotnictvi",
    source_id: null // Bude nastaveno pozdƒõji
  },
  {
    title: "Nov√Ω rekord v exportu ƒçesk√Ωch technologi√≠",
    summary: "ƒåesk√© technologick√© spoleƒçnosti loni vyvezly zbo≈æ√≠ a slu≈æby v rekordn√≠ hodnotƒõ 850 miliard korun. Nejvƒõt≈°√≠ pod√≠l m√° automotive a IT sektor. Export roste zejm√©na do zem√≠ EU a USA, kde ƒçesk√© firmy z√≠sk√°vaj√≠ nov√© kontrakty v oblasti software developmentu.",
    category: "Finance",
    published_at: new Date(Date.now() - 4 * 60 * 60 * 1000).toISOString(), // 4 hodiny zpƒõt
    original_url: "https://hn.cz/export-technologii-rekord",
    source_id: null
  },
  {
    title: "ƒåesk√° hokejov√° reprezentace m√≠≈ô√≠ na mistrovstv√≠ svƒõta",
    summary: "Tren√©r Radim Rul√≠k nominoval fin√°ln√≠ sestavu pro nadch√°zej√≠c√≠ mistrovstv√≠ svƒõta v hokeji. T√Ωm povede kapit√°n Jan Kov√°≈ô, nechyb√≠ ani hvƒõzdy z NHL vƒçetnƒõ Davida Pastr≈à√°ka. P≈ô√≠pravn√© z√°pasy uk√°zaly dobrou formu t√Ωmu, kter√Ω bude pat≈ôit mezi favority turnaje.",
    category: "Sport", 
    published_at: new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString(), // 6 hodin zpƒõt
    original_url: "https://isport.blesk.cz/hokej-ms-nominace",
    source_id: null
  },
  {
    title: "Kybernetick√° bezpeƒçnost v dobƒõ AI",
    summary: "S r≈Østem popularity umƒõl√© inteligence rostou i kybernetick√© hrozby. Experti varuj√≠ p≈ôed nov√Ωmi typy √∫tok≈Ø vyu≈æ√≠vaj√≠c√≠mi AI pro vytv√°≈ôen√≠ sofistikovan√Ωch phishingov√Ωch kampan√≠. ƒåesk√© √∫≈ôady p≈ôipravuj√≠ novou strategii kybernetick√© bezpeƒçnosti na roky 2024-2028.",
    category: "Technologie",
    published_at: new Date(Date.now() - 8 * 60 * 60 * 1000).toISOString(), // 8 hodin zpƒõt
    original_url: "https://root.cz/kyberneticka-bezpecnost-ai",
    source_id: null
  },
  {
    title: "Zelen√° transformace ƒçesk√©ho pr≈Ømyslu",
    summary: "ƒåesk√© firmy investuj√≠ rekordn√≠ ƒç√°stky do zelen√©ho p≈ôechodu. Automobilky p≈ôestavuj√≠ v√Ωrobu na elektrick√° vozidla, energetick√© spoleƒçnosti stav√≠ nov√© obnoviteln√© zdroje. EU poskytuje na transformaci dotace v ≈ô√°du stovek miliard korun.",
    category: "Finance",
    published_at: new Date(Date.now() - 12 * 60 * 60 * 1000).toISOString(), // 12 hodin zpƒõt
    original_url: "https://aktualne.cz/zelena-transformace-prumysl",
    source_id: null
  },
  {
    title: "Nov√° √©ra mobiln√≠ch plateb v ƒåesku",
    summary: "ƒåesk√Ω trh s mobiln√≠mi platbami zaznamenal v lo≈àsk√©m roce r≈Øst o 45%. Nejpopul√°rnƒõj≈°√≠ jsou bezkontaktn√≠ platby p≈ôes smartphone. Banky spou≈°tƒõj√≠ nov√© slu≈æby zahrnuj√≠c√≠ platby pomoc√≠ QR k√≥d≈Ø a integraci s e-commerce platformami.",
    category: "Finance",
    published_at: new Date(Date.now() - 18 * 60 * 60 * 1000).toISOString(), // 18 hodin zpƒõt
    original_url: "https://idnes.cz/mobilni-platby-rust",
    source_id: null
  },
  {
    title: "ƒåe≈°t√≠ v√Ωvoj√°≈ôi vytvo≈ôili revoluƒçn√≠ zdravotnickou aplikaci",
    summary: "Startup z Brna uvedl na trh aplikaci pro vzd√°len√© monitorov√°n√≠ pacient≈Ø s chronick√Ωmi onemocnƒõn√≠mi. Syst√©m vyu≈æ√≠v√° AI pro predikci zdravotn√≠ch komplikac√≠ a automaticky upozor≈àuje l√©ka≈ôe na rizikov√© stavy. Aplikace ji≈æ z√≠skala certifikaci pro pou≈æit√≠ v EU.",
    category: "Technologie",
    published_at: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(), // 1 den zpƒõt
    original_url: "https://lupa.cz/zdravotnicka-aplikace-ai",
    source_id: null
  },
  {
    title: "ƒåesk√° fotbalov√° liga p≈ôin√°≈°√≠ technologick√© inovace",
    summary: "Fortuna Liga zav√°d√≠ nejmodernƒõj≈°√≠ VAR syst√©m v Evropƒõ. Nov√° technologie umo≈æn√≠ je≈°tƒõ p≈ôesnƒõj≈°√≠ rozhodov√°n√≠ rozhodƒç√≠ch. Kromƒõ toho liga testuje AI syst√©my pro anal√Ωzu hr√°ƒçsk√©ho v√Ωkonu a prevenci zranƒõn√≠.",
    category: "Sport",
    published_at: new Date(Date.now() - 30 * 60 * 60 * 1000).toISOString(), // 30 hodin zpƒõt
    original_url: "https://isport.blesk.cz/fotbal-var-technologie",
    source_id: null
  }
];

async function seedDatabase(userId = null) {
  try {
    console.log('üå± Zaƒç√≠n√°m nahr√°v√°n√≠ uk√°zkov√Ωch dat...');

    // 1. Pou≈æijeme p≈ôedan√Ω user ID nebo vytvo≈ô√≠me doƒçasn√© data
    let targetUserId = userId;
    
    if (!targetUserId) {
      console.log('‚ö†Ô∏è  Nen√≠ zad√°n user ID.');
      console.log('   Spus≈•te skript s parametrem: node seed-data.js YOUR_USER_ID');
      console.log('   Nebo pou≈æijeme doƒçasn√Ω ID pro demonstraci...');
      targetUserId = '00000000-0000-0000-0000-000000000000'; // Doƒçasn√© ID
    }

    console.log(`üë§ Pou≈æiji user ID: ${targetUserId}`);

    // 2. Nahraju zdroje
    console.log('üì∞ Nahr√°v√°m zdroje zpr√°v...');
    const sourcesToInsert = sampleSources.map(source => ({
      ...source,
      created_by_user_id: targetUserId
    }));

    const { data: insertedSources, error: sourcesError } = await supabase
      .from('sources')
      .insert(sourcesToInsert)
      .select();

    if (sourcesError) {
      console.error('‚ùå Chyba p≈ôi nahr√°v√°n√≠ zdroj≈Ø:', sourcesError);
      return;
    }

    console.log(`‚úÖ √öspƒõ≈°nƒõ nahr√°no ${insertedSources.length} zdroj≈Ø`);

    // 3. Namapuju zdroje podle n√°zvu pro ƒçl√°nky
    const sourceMap = {};
    insertedSources.forEach(source => {
      sourceMap[source.name] = source.id;
    });

    // 4. Nahraju ƒçl√°nky s referencemi na zdroje
    console.log('üìÑ Nahr√°v√°m ƒçl√°nky...');
    const articlesToInsert = sampleArticles.map(article => {
      let sourceId = null;
      
      // Namapuj ƒçl√°nek na spr√°vn√Ω zdroj podle URL nebo kategorie
      if (article.original_url.includes('ct24')) {
        sourceId = sourceMap['ƒåT24'];
      } else if (article.original_url.includes('idnes')) {
        sourceId = sourceMap['iDNES.cz'];
      } else if (article.original_url.includes('aktualne')) {
        sourceId = sourceMap['Aktu√°lnƒõ.cz'];
      } else if (article.original_url.includes('root')) {
        sourceId = sourceMap['Root.cz'];
      } else if (article.original_url.includes('lupa')) {
        sourceId = sourceMap['Lupa.cz'];
      } else if (article.original_url.includes('isport')) {
        sourceId = sourceMap['iSport.cz'];
      } else if (article.original_url.includes('hn.cz')) {
        sourceId = sourceMap['Hospod√°≈ôsk√© noviny'];
      }
      
      return {
        ...article,
        source_id: sourceId
      };
    });

    const { data: insertedArticles, error: articlesError } = await supabase
      .from('articles')
      .insert(articlesToInsert)
      .select();

    if (articlesError) {
      console.error('‚ùå Chyba p≈ôi nahr√°v√°n√≠ ƒçl√°nk≈Ø:', articlesError);
      return;
    }

    console.log(`‚úÖ √öspƒõ≈°nƒõ nahr√°no ${insertedArticles.length} ƒçl√°nk≈Ø`);

    // 5. Vytvo≈ô√≠m uk√°zkov√© user_article_status z√°znamy
    console.log('üë§ Vytv√°≈ô√≠m stav ƒçl√°nk≈Ø pro u≈æivatele...');
    const userArticleStatuses = insertedArticles.slice(0, 5).map(article => ({
      user_id: targetUserId,
      article_id: article.id,
      is_read: Math.random() > 0.5, // N√°hodnƒõ oznaƒç√≠m nƒõkter√© jako p≈ôeƒçten√©
      is_selected_for_audio: Math.random() > 0.7, // N√°hodnƒõ oznaƒç√≠m nƒõkter√© pro audio
      read_at: Math.random() > 0.5 ? new Date().toISOString() : null,
      selected_at: Math.random() > 0.7 ? new Date().toISOString() : null
    }));

    const { error: statusError } = await supabase
      .from('user_article_status')
      .insert(userArticleStatuses);

    if (statusError) {
      console.error('‚ùå Chyba p≈ôi vytv√°≈ôen√≠ stav≈Ø ƒçl√°nk≈Ø:', statusError);
      return;
    }

    console.log(`‚úÖ √öspƒõ≈°nƒõ vytvo≈ôeno ${userArticleStatuses.length} stav≈Ø ƒçl√°nk≈Ø`);

    console.log('\nüéâ Uk√°zkov√° data byla √∫spƒõ≈°nƒõ nahr√°na!');
    console.log('\nüìä Shrnut√≠:');
    console.log(`   ‚Ä¢ Zdroje: ${insertedSources.length}`);
    console.log(`   ‚Ä¢ ƒål√°nky: ${insertedArticles.length}`);
    console.log(`   ‚Ä¢ Stavy ƒçl√°nk≈Ø: ${userArticleStatuses.length}`);
    console.log(`   ‚Ä¢ User ID: ${targetUserId}`);
    
  } catch (error) {
    console.error('üí• Neoƒçek√°van√° chyba:', error);
  }
}

// Spu≈°tƒõn√≠
const userIdArg = process.argv[2];
seedDatabase(userIdArg);
